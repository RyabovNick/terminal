<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Page Title</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body onload="getVideos()">
        <!--
            <video onended="nextVideo()" id="video" width="100%" height="100%" autoplay>
                <source id="source" src="https://unidb.ru/files/2.mp4" type="video/mp4" />
                Your browser does not support the video tag.
            </video>
        -->
    </body>
</html>

<style>
    body,
    html {
        height: 100%;
    }
    body {
        margin: 0;
    }

    html {
        overflow: hidden;
    }
</style>

<script>
    var links = []
    var firstRun = true

    function nextVideo(id) {
        if (!firstRun) {
            let el = document.getElementById('video')
            el.parentNode.removeChild(el)
        }

        firstRun = false

        let newVideo = document.createElement('video')
        //Loop
        if (id + 1 == links.length) {
            newVideo.setAttribute('onended', 'getVideos()')
        } else {
            newVideo.setAttribute('onended', `nextVideo(${id + 1})`)
        }
        newVideo.setAttribute('id', 'video')
        newVideo.setAttribute('width', '100%')
        newVideo.setAttribute('height', '100%')
        newVideo.muted = true
        newVideo.setAttribute('autoplay', '')

        let newSource = document.createElement('source')
        newSource.setAttribute('id', 'source')
        newSource.setAttribute('src', `https://unidb.ru/${links[id]}`)
        newSource.setAttribute('type', 'video/mp4')

        newVideo.appendChild(newSource)

        let body = document.getElementsByTagName('body')[0]
        body.appendChild(newVideo)

        //newVideo.play()
    }

    function getVideos() {
        let xhr = new XMLHttpRequest()
        xhr.onreadystatechange = function() {
            console.log('state: ' + this.readyState + ' status: ' + this.status)
            if (this.readyState == 4 && this.status == 200) {
                links = []

                var arr = JSON.parse(this.responseText)

                arr.forEach(element => {
                    links.push(element.link)
                })

                console.log(links)
                nextVideo(0)
            }
        }
        //local
        //xhr.open('GET', 'http://localhost:3000/api/getFiles', true)
        xhr.open('GET', 'https://unidb.ru:8446/api/getVideos', true)
        xhr.send()
    }
</script>
