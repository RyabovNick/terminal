<!DOCTYPE html>
<html>
    <head>
        <style>
            body,
            html {
                height: 100%;
                background: black;
            }
            body {
                margin: 0;
            }

            html {
                overflow: hidden;
            }
        </style>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Terminal</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body onload="getPictures()"></body>
</html>

<script>
    var arr = {}

    function getPictures() {
        let xhr = new XMLHttpRequest()
        xhr.onreadystatechange = function() {
            console.log('state: ' + this.readyState + ' status: ' + this.status)
            if (this.readyState == 4 && this.status == 200) {
                arr = JSON.parse(this.responseText)
                console.log('arr: ', arr)
                console.log('arr: ', arr.length)

                nextPictures(0)
            }
        }
        //local
        //xhr.open('GET', 'http://localhost:3000/api/getFiles', true)
        xhr.open('GET', 'https://unidb.ru:8446/api/getPictures', true)
        xhr.send()
    }

    function nextPictures(id) {
        var len = arr.length

        console.log('showImage: ' + Date(Date.now()))

        var entry = arr[id]
        console.log('entry: ', entry)

        var body = document.getElementsByTagName('body')[0]

        var img = document.createElement('img')
        img.src = `https://unidb.ru/${entry.link}`
        img.id = 'img'
        img.setAttribute('width', '100%')
        img.setAttribute('height', '100%')
        body.appendChild(img)

        //ждём заданное количество времени
        setTimeout(function() {
            console.log('timeout')
            id++

            let el = document.getElementById('img')
            el.parentNode.removeChild(el)

            if (id >= len) {
                getPictures()
            } else {
                nextPictures(id)
            }
        }, 1000 * entry.amount_time)
    }
</script>
