<!DOCTYPE html>
<html>
    <head>
        <style>
            body,
            html {
                height: 100%;
            }
            body {
                margin: 0;
            }

            html {
                overflow: hidden;
            }
        </style>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Terminal</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body onload="getPictures()"></body>
</html>

<script>
    var links = []
    var arr = {}

    function getPictures() {
        let xhr = new XMLHttpRequest()
        xhr.onreadystatechange = function() {
            console.log('state: ' + this.readyState + ' status: ' + this.status)
            if (this.readyState == 4 && this.status == 200) {
                links = []

                arr = JSON.parse(this.responseText)
                console.log('arr: ', arr)

                arr.forEach(element => {
                    links.push(element.link)
                })

                console.log(links)
                nextPictures(0)
            }
        }
        //local
        //xhr.open('GET', 'http://localhost:3000/api/getFiles', true)
        xhr.open('GET', 'https://unidb.ru:8446/api/getPictures', true)
        xhr.send()
    }

    function nextPictures(id) {
        var len = arr.length

        console.log('showImage: ' + Date(Date.now()))

        var entry = arr[id]
        console.log('entry: ', entry)

        var body = document.getElementsByTagName('body')[0]

        var img = document.createElement('img')
        img.src = `https://unidb.ru/${entry.link}`
        img.id = 'img'
        img.setAttribute('width', '100%')
        img.setAttribute('height', '100%')
        body.appendChild(img)

        //ждём заданное количество времени
        setTimeout(function() {
            console.log('timeout')
            id++

            let el = document.getElementById('img')
            el.parentNode.removeChild(el)

            if (id >= len) {
                getPictures()
            } else {
                nextPictures(id)
            }
        }, 1000 * entry.amount_time)
    }

    // function loop() {
    //     function checker() {
    //         console.log('checker: ' + Date(Date.now()))
    //         var xhr = new XMLHttpRequest()
    //         xhr.onreadystatechange = function() {
    //             console.log('state: ' + this.readyState + ' status: ' + this.status)
    //             if (this.readyState == 4 && this.status == 200) {
    //                 //document.getElementById('form').innerHTML = this.responseText
    //                 var arr = JSON.parse(this.responseText)

    //                 var idx = 0
    //                 var len = arr.length

    //                 function showImage() {
    //                     console.log('showImage: ' + Date(Date.now()))
    //                     console.log('idx: ', idx)
    //                     console.log('len: ', len)

    //                     var entry = arr[idx]
    //                     console.log('entry: ', entry)

    //                     document.getElementById('form').innerHTML = entry.file

    //                     idx++

    //                     if (idx >= len) {
    //                         idx = 0
    //                     }
    //                 }
    //                 setInterval(showImage, 30 * 1000)

    //                 //showImage()
    //             }
    //         }
    //         xhr.open('GET', 'https://unidb.ru:8446/api/getPictures', true)
    //         xhr.send()
    //     }
    //     setInterval(checker, 60 * 1000)

    //     checker()
    // }
</script>
